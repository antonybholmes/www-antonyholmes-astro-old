---
import PostsPage from "../../../components/pages/posts-page"
import ContentLayout from "../../../layouts/ContentLayout.astro"
import { getAuthorMap } from "../../../lib/api/author"
import {
  addAuthorsToPosts,
  addExcerpts,
  getAllPosts,
  sortPosts,
} from "../../../lib/api/post"
import { getPageCount, paginate } from "../../../lib/paginate"

export async function getStaticPaths() {
  const allPosts = addAuthorsToPosts(
    await Promise.all(addExcerpts(sortPosts(getAllPosts()))),
    getAuthorMap()
  )

  const pages = getPageCount(allPosts)

  const paths = paginate(allPosts, "")

  return paths
}

const { page, pages, data } = Astro.props
---

<ContentLayout title="Blog" tab="Blog">
  <PostsPage posts={data} page={page} pages={pages} slot="main" />
</ContentLayout>
