---
import PostsPage from "../components/pages/PostsPage.astro"
import ContentLayout from "../layouts/ContentLayout.astro"
import { getAuthorMap } from "../lib/api/author"
import {
  addAuthorsToPosts,
  addExcerpts,
  getAllPosts,
  sortPosts,
} from "../lib/api/post"
import { getPageCount, getPageItems } from "../lib/paginate"

const allPosts = sortPosts(getAllPosts())
const pages = getPageCount(allPosts)

const posts = addAuthorsToPosts(
  await Promise.all(addExcerpts(getPageItems(allPosts, 0, 10))),
  getAuthorMap()
)
---

<ContentLayout title="Blog" showTitle={false}>
  <PostsPage posts={posts} page={0} pages={pages} slot="main" />
</ContentLayout>
